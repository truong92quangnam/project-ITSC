<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Grid Cache Gallery with WebSocket</title>
    <style>
        #gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            grid-gap: 12px;
            padding: 24px;
        }
        #gallery img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
    </style>
</head>
<body>
    <div id="gallery"></div>
    <script>
        const gallery = document.getElementById("gallery");

        // Hàm hiển thị lưới ảnh từ array url
        function showGallery(urls) {
            gallery.innerHTML = "";
            urls.forEach(url => {
                const img = document.createElement("img");
                img.src = url;
                img.alt = "Image";
                gallery.appendChild(img);
            });
        }

        // Kiểm tra cache khi load trang
        const cacheData = localStorage.getItem('gallery_cache');
        if (cacheData) {
            const urls = JSON.parse(cacheData);
            showGallery(urls);
        }

        // Kết nối WebSocket
        const ws = new WebSocket("ws://localhost:8000/ws/Original");
        ws.onopen = () => {
            console.log("Đã kết nối WebSocket!");
        };
        ws.onmessage = (event) => {
            const data = JSON.parse(event.data); // array object từ backend
            const urls = data.map(item => item.url);
            showGallery(urls);

            // Lưu cache vào localStorage
            localStorage.setItem('gallery_cache', JSON.stringify(urls));
        };
    </script>
</body>
</html>